<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Lock System Pro</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 100%;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .auth-container, .home-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        h1, h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        textarea {
            resize: none;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .toggle-auth {
            text-align: center;
            margin-top: 15px;
        }
        
        .toggle-auth a {
            color: #3498db;
            text-decoration: none;
            cursor: pointer;
        }
        
        .error-message {
            color: #e74c3c;
            text-align: center;
            margin-top: 10px;
        }
        
        .success-message {
            color: #2ecc71;
            text-align: center;
            margin-top: 10px;
        }
        
        /* Home Page Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .profile {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }
        
        .logout-btn {
            background-color: #e74c3c;
            width: auto;
            padding: 8px 15px;
        }
        
        .logout-btn:hover {
            background-color: #c0392b;
        }
        
        .menu-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
            width: auto;
            padding: 0 10px;
        }
        
        .lock-btn-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .lock-btn {
            width: 60px;
            height: 80px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%233498db"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border: none;
            background-color: transparent;
            cursor: pointer;
        }
        
        .lock-btn:hover {
            transform: scale(1.1);
        }
        
        /* Secure Area Modal */
        .secure-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            padding: 20px;
        }
        
        .secure-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-secure {
            font-size: 24px;
            cursor: pointer;
        }
        
        .secure-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px;
            background-color: #eee;
            border: none;
            cursor: pointer;
        }
        
        .tab-btn.active {
            background-color: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
            flex: 1;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .secure-textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .media-preview {
            max-width: 100%;
            max-height: 200px;
            margin-bottom: 15px;
            display: none;
        }
        
        .save-btn {
            background-color: #2ecc71;
        }
        
        .save-btn:hover {
            background-color: #27ae60;
        }
        
        /* Profile Modal */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            padding: 20px;
        }
        
        .profile-form {
            margin-top: 20px;
        }
        
        .profile-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 20px;
            display: block;
        }
        
        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .color-option.selected {
            border-color: #000;
        }
        
        /* App Upload Modal */
        .app-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            padding: 20px;
        }
        
        .app-form {
            margin-top: 20px;
        }
        
        /* Review Password Modal */
        .review-password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            padding: 20px;
            text-align: center;
        }.review-password-form {
            max-width: 300px;
            margin: 50px auto;
        }
        
        /* Apps Display */
        .apps-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
            flex: 1;
            overflow-y: auto;
            padding-bottom: 80px; /* Space for lock button */
        }
        
        .app-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: white;
            transition: transform 0.2s;
            cursor: pointer;
        }
        
        .app-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .app-item h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .app-item p {
            margin-bottom: 10px;
            color: #666;
        }
        
        .app-item img {
            max-width: 100%;
            max-height: 150px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        
        .app-item .app-meta {
            display: flex;
            justify-content: space-between;
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .stars {
            color: #f1c40f;
        }
        
        /* App Play Modal */
        .app-play-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            padding: 20px;
        }
        
        .app-play-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .app-play-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }
        
        .app-play-frame {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .app-play-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .rate-btn {
            background-color: #f1c40f;
        }
        
        .close-app-btn {
            background-color: #7f8c8d;
        }
    </style>
</head>
<body>
    <!-- Auth Container (Login/Signup) -->
    <div class="container auth-container" id="authContainer">
        <div id="loginForm">
            <h1>Login</h1>
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Enter your password">
            </div>
            <button id="loginBtn">Login</button>
            <div class="toggle-auth">
                <p>Don't have an account? <a id="showSignup">Sign up</a></p>
            </div>
            <div class="error-message" id="loginError"></div>
        </div>
        
        <div id="signupForm" style="display: none;">
            <h1>Sign Up</h1>
            <div class="form-group">
                <label for="signupName">Name</label>
                <input type="text" id="signupName" placeholder="Enter your name">
            </div>
            <div class="form-group">
                <label for="signupEmail">Email</label>
                <input type="email" id="signupEmail" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="signupPassword">Password</label>
                <input type="password" id="signupPassword" placeholder="Create a password">
            </div>
            <div class="form-group">
                <label for="signupPhoto">Profile Photo URL (Optional)</label>
                <input type="text" id="signupPhoto" placeholder="Paste image link">
            </div>
            <button id="signupBtn">Sign Up</button>
            <div class="toggle-auth">
                <p>Already have an account? <a id="showLogin">Login</a></p>
            </div>
            <div class="error-message" id="signupError"></div>
            <div class="success-message" id="signupSuccess"></div>
        </div>
    </div>
    
    <!-- Home Container -->
    <div class="container home-container" id="homeContainer" style="display: none;">
        <div class="header">
            <div class="profile" id="profileBtn">
                <img id="profilePic" src="https://via.placeholder.com/150" alt="Profile" class="profile-pic">
                <span id="profileName"></span>
            </div>
            <div>
                <button class="menu-btn" id="menuBtn">⋮</button>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>
        
        <h2>Welcome, <span id="welcomeName"></span></h2>
        
        <div id="appsDisplay" class="apps-container">
            <!-- Approved apps will be displayed here -->
        </div>
        
        <div class="lock-btn-container">
            <button class="lock-btn" id="lockBtn" title="Open secure area"></button>
        </div>
    </div>
    
    <!-- Secure Area Modal -->
    <div class="secure-modal" id="secureModal">
        <div class="secure-header">
            <h2>Your Secure Data</h2>
            <span class="close-secure" id="closeSecure">&times;</span>
        </div>
        
        <div class="secure-content">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="notes">Notes</button>
                <button class="tab-btn" data-tab="media">Media</button>
                <button class="tab-btn" data-tab="review">Review Apps</button>
            </div>
            
            <div class="tab-content active" id="notesTab">
                <textarea class="secure-textarea" id="secureTextarea" placeholder="Store your secure notes here..."></textarea>
                <button class="save-btn" id="saveNotesBtn">Save Notes</button>
            </div>
            
            <div class="tab-content" id="mediaTab">
                <select id="mediaType">
                    <option value="image">Image</option>
                    <option value="video">Video</option>
                </select>
                <input type="text" id="mediaUrl" placeholder="Paste media URL" style="margin-top: 10px;">
                <textarea id="mediaCaption" placeholder="Caption (optional)" style="margin-top: 10px;"></textarea>
                <img src="" class="media-preview" id="imagePreview">
                <video controls class="media-preview" id="videoPreview"></video>
                <button class="save-btn" id="saveMediaBtn" style="margin-top: 10px;">Save Media</button>
            </div>
            
            <div class="tab-content" id="reviewTab">
                <div id="pendingApps">
                    <!-- Pending apps for review will be displayed here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="secure-header">
            <h2>Edit Profile</h2>
            <span class="close-secure" id="closeProfileModal">&times;</span>
        </div>
        
        <img src="https://via.placeholder.com/150" class="profile-preview" id="profilePreview">
        
        <div class="profile-form">
            <div class="form-group">
                <label for="editName">Name</label>
                <input type="text" id="editName">
            </div>
            
            <div class="form-group">
                <label for="editPhoto">Profile Photo URL</label>
                <input type="text" id="editPhoto" placeholder="Paste image link">
            </div>
            
            <div class="form-group">
                <label>Profile Color</label>
                <div class="color-options">
                    <div class="color-option selected" style="background-color: #3498db;" data-color="#3498db"></div>
                    <div class="color-option" style="background-color: #e74c3c;" data-color="#e74c3c"></div>
                    <div class="color-option" style="background-color: #2ecc71;" data-color="#2ecc71"></div>
                    <div class="color-option" style="background-color: #f1c40f;" data-color="#f1c40f"></div>
                    <div class="color-option" style="background-color: #9b59b6;" data-color="#9b59b6"></div>
                    <div class="color-option" style="background-color: #1abc9c;" data-color="#1abc9c"></div>
                </div>
            </div>
            
            <button class="save-btn" id="saveProfileBtn">Save Profile</button>
        </div>
    </div>
    
    <!-- App Upload Modal -->
    <div class="app-modal" id="appModal">
        <div class="secure-header">
            <h2>Upload New App</h2>
            <span class="close-secure" id="closeAppModal">&times;</span>
        </div>
        
        <div class="app-form">
            <div class="form-group">
                <label for="appName">App Name</label>
                <input type="text" id="appName" placeholder="Enter app name">
            </div>
            
            <div class="form-group">
                <label for="appDescription">Description</label>
                <textarea id="appDescription" placeholder="Enter app description"></textarea>
            </div>
            
            <div class="form-group">
                <label for="appImage">App Image URL</label>
                <input type="text" id="appImage" placeholder="Paste image link">
            </div>
            
            <div class="form-group">
                <label for="appCode">App Code (HTML/JS/CSS)</label>
                <textarea id="appCode" placeholder="Paste your app code here"></textarea>
            </div>
            
            <button class="save-btn" id="submitAppBtn">Submit App</button>
            <div class="error-message" id="appError"></div>
        </div>
    </div>
    
    <!-- Review Password Modal -->
    <div class="review-password-modal" id="reviewPasswordModal">
        <div class="secure-header">
            <h2>Enter Review Password</h2>
        </div>
        
        <div class="review-password-form">
            <div class="form-group">
                <input type="password" id="reviewPassword" placeholder="Enter review password">
            </div>
            <button id="submitReviewPassword">Submit</button>
            <div class="error-message" id="reviewPasswordError"></div>
        </div>
    </div>
    
    <!-- App Play Modal -->
    <div class="app-play-modal" id="appPlayModal">
        <div class="app-play-header">
            <h2 id="playAppName">App Name</h2>
            <span class="close-secure" id="closeAppPlayModal">&times;</span>
        </div>
        
        <div class="app-play-content">
            <iframe class="app-play-frame" id="appPlayFrame" sandbox="allow-scripts allow-same-origin"></iframe>
            <div class="app-play-actions">
                <button class="rate-btn" id="rateAppBtn">Rate this App</button>
                <button class="close-app-btn" id="closeAppPlayBtn">Close</button>
            </div>
        </div>
    </div>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDtHmRpLsIXvMAGPsEZ2L4wveGGxVUTCyM",
            authDomain: "sample-firebase-ai-app-1756e.firebaseapp.com",
            databaseURL: "https://sample-firebase-ai-app-1756e-default-rtdb.firebaseio.com",
            projectId: "sample-firebase-ai-app-1756e",
            storageBucket: "sample-firebase-ai-app-1756e.appspot.com",
            messagingSenderId: "574833031218",
            appId: "1:574833031218:web:ccdc4ff48358e9686b242b"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // DOM Elements
        const authContainer = document.getElementById('authContainer');
        const homeContainer = document.getElementById('homeContainer');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const showSignup = document.getElementById('showSignup');
        const showLogin = document.getElementById('showLogin');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const loginEmail = document.getElementById('loginEmail');
        const loginPassword = document.getElementById('loginPassword');
        const signupName = document.getElementById('signupName');
        const signupEmail = document.getElementById('signupEmail');
        const signupPassword = document.getElementById('signupPassword');
        const signupPhoto = document.getElementById('signupPhoto');
        const loginError = document.getElementById('loginError');
        const signupError = document.getElementById('signupError');
        const signupSuccess = document.getElementById('signupSuccess');
        const welcomeName = document.getElementById('welcomeName');
        const profileName = document.getElementById('profileName');
        const profilePic = document.getElementById('profilePic');
        const logoutBtn = document.getElementById('logoutBtn');
        const menuBtn = document.getElementById('menuBtn');
        const lockBtn = document.getElementById('lockBtn');
        const secureModal = document.getElementById('secureModal');
        const closeSecure = document.getElementById('closeSecure');
        const secureTextarea = document.getElementById('secureTextarea');
        const saveNotesBtn = document.getElementById('saveNotesBtn');
        const profileBtn = document.getElementById('profileBtn');
        const profileModal = document.getElementById('profileModal');
        const closeProfileModal = document.getElementById('closeProfileModal');
        const profilePreview = document.getElementById('profilePreview');
        const editName = document.getElementById('editName');
        const editPhoto = document.getElementById('editPhoto');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const mediaType = document.getElementById('mediaType');
        const mediaUrl = document.getElementById('mediaUrl');
        const mediaCaption = document.getElementById('mediaCaption');
        const imagePreview = document.getElementById('imagePreview');
        const videoPreview = document.getElementById('videoPreview');
        const saveMediaBtn = document.getElementById('saveMediaBtn');
        const colorOptions = document.querySelectorAll('.color-option');
        const appModal = document.getElementById('appModal');
        const closeAppModal = document.getElementById('closeAppModal');
        const appName = document.getElementById('appName');
        const appDescription = document.getElementById('appDescription');
        const appImage = document.getElementById('appImage');
        const appCode = document.getElementById('appCode');
        const submitAppBtn = document.getElementById('submitAppBtn');
        const appError = document.getElementById('appError');
        const reviewPasswordModal = document.getElementById('reviewPasswordModal');
        const reviewPassword = document.getElementById('reviewPassword');
        const submitReviewPassword = document.getElementById('submitReviewPassword');
        const reviewPasswordError = document.getElementById('reviewPasswordError');
        const pendingApps = document.getElementById('pendingApps');
        const appsDisplay = document.getElementById('appsDisplay');
        const appPlayModal = document.getElementById('appPlayModal');
        const playAppName = document.getElementById('playAppName');
        const appPlayFrame = document.getElementById('appPlayFrame');
        const closeAppPlayModal = document.getElementById('closeAppPlayModal');
        const closeAppPlayBtn = document.getElementById('closeAppPlayBtn');
        const rateAppBtn = document.getElementById('rateAppBtn');

        // Current user data
        let currentUserData = {};
        let selectedColor = "#3498db";
        let currentReviewAppId = null;
        let currentPlayingAppId = null;
        const REVIEW_PASSWORD = "sojim@123456789";

        // Toggle between login and signup forms
        showSignup.addEventListener('click', () => {
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
            loginError.textContent = '';
        });
        
        showLogin.addEventListener('click', () => {
            signupForm.style.display = 'none';
            loginForm.style.display = 'block';
            signupError.textContent = '';
            signupSuccess.textContent = '';
        });
        
        // Sign Up Function
        signupBtn.addEventListener('click', () => {
            const email = signupEmail.value;
            const password = signupPassword.value;
            const name = signupName.value;
            const photoUrl = signupPhoto.value;
            
            if (!email || !password || !name) {
                signupError.textContent = 'Please fill in all required fields';
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Save user data to database
                    return database.ref('users/' + user.uid).set({
                        name: name,
                        email: email,
                        photoUrl: photoUrl || '',
                        secureData: '',
                        secureMedia: {},
                        profileColor: "#3498db",
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });
                })
                .then(() => {
                    signupSuccess.textContent = 'Account created successfully!';
                    signupError.textContent = '';
                    
                    // Clear form
                    signupName.value = '';
                    signupEmail.value = '';
                    signupPassword.value = '';
                    signupPhoto.value = '';
                    
                    // Show login form
                    signupForm.style.display = 'none';
                    loginForm.style.display = 'block';
                })
                .catch((error) => {
                    signupError.textContent = error.message;
                });
        });
        
        // Login Function
        loginBtn.addEventListener('click', () => {
            const email = loginEmail.value;
            const password = loginPassword.value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // User logged in successfully
                    loginError.textContent = '';
                    checkAuthState();
                })
                .catch((error) => {
                    loginError.textContent = error.message;
                });
        });
        
        // Logout Function
        logoutBtn.addEventListener('click', () => {
            auth.signOut().then(() => {
                homeContainer.style.display = 'none';
                authContainer.style.display = 'block';
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                loginEmail.value = '';
                loginPassword.value = '';
            });
        });
        
        // Menu Button Click
        menuBtn.addEventListener('click', () => {
            appModal.style.display = 'block';
        });
        
        // Close App Modal
        closeAppModal.addEventListener('click', () => {
            appModal.style.display = 'none';
            appError.textContent = '';
        });
        
        // Submit App
        submitAppBtn.addEventListener('click', () => {
            const name = appName.value;
            const description = appDescription.value;
            const image = appImage.value;
            const code = appCode.value;
            
            if (!name || !code) {
                appError.textContent = 'App name and code are required';
                return;
            }
            
            const userId = auth.currentUser.uid;
            const newAppKey = database.ref().child('apps').push().key;
            
            database.ref('apps/' + newAppKey).set({
                name: name,
                description: description || '',
                image: image || '',
                code: code,
                status: 'pending',
                submittedBy: userId,
                submittedAt: firebase.database.ServerValue.TIMESTAMP,
                ratings: {},
                playCount: 0
            })
            .then(() => {
                appModal.style.display = 'none';
                appName.value = '';
                appDescription.value = '';
                appImage.value = '';
                appCode.value = '';
                appError.textContent = '';
                alert('App submitted for review!');
            })
            .catch(error => {
                appError.textContent = error.message;
            });
        });
        
        // Lock Button Click - Show Secure Area
        lockBtn.addEventListener('click', () => {
            const email = prompt("Enter your email:");
            const password = prompt("Enter your password:");
            
            if (email && password) {
                const credential = firebase.auth.EmailAuthProvider.credential(email, password);
                
                // Reauthenticate user
                auth.currentUser.reauthenticateWithCredential(credential)
                    .then(() => {
                        // Authentication successful - show secure modal
                        secureModal.style.display = 'block';
                        
                        // Load secure data
                        const userId = auth.currentUser.uid;
                        database.ref('users/' + userId).once('value')
                            .then((snapshot) => {
                                const userData = snapshot.val();
                                if (userData.secureData) {
                                    secureTextarea.value = userData.secureData;
                                }
                            });
                    })
                    .catch((error) => {
                        alert("Authentication failed: " + error.message);
                    });
            }
        });
        
        // Close Secure Modal
        closeSecure.addEventListener('click', () => {
            secureModal.style.display = 'none';
        });
        
        // Save Secure Notes
        saveNotesBtn.addEventListener('click', () => {
            const userId = auth.currentUser.uid;
            const data = secureTextarea.value;
            
            database.ref('users/' + userId).update({
                secureData: data
            }).then(() => {
                alert('Notes saved securely!');
            }).catch(error => {
                alert('Error saving notes: ' + error.message);
            });
        });
        
        // Profile Button Click
        profileBtn.addEventListener('click', () => {
            profileModal.style.display = 'block';
            editName.value = currentUserData.name || '';
            editPhoto.value = currentUserData.photoUrl || '';
            profilePreview.src = currentUserData.photoUrl || 'https://via.placeholder.com/150';
            
            // Select current color
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.color === currentUserData.profileColor) {
                    option.classList.add('selected');
                    selectedColor = option.dataset.color;
                }
            });
        });
        
        // Close Profile Modal
        closeProfileModal.addEventListener('click', () => {
            profileModal.style.display = 'none';
        });
        
        // Save Profile
        saveProfileBtn.addEventListener('click', () => {
            const userId = auth.currentUser.uid;
            const name = editName.value;
            const photoUrl = editPhoto.value;
            
            if (!name) {
                alert('Name is required');
                return;
            }
            
            database.ref('users/' + userId).update({
                name: name,
                photoUrl: photoUrl || '',
                profileColor: selectedColor
            })
            .then(() => {
                // Update UI
                welcomeName.textContent = name;
                profileName.textContent = name;
                profilePic.src = photoUrl || 'https://via.placeholder.com/150';
                profileModal.style.display = 'none';
                alert('Profile updated successfully!');
                
                // Reload user data
                checkAuthState();
            })
            .catch(error => {
                alert('Error updating profile: ' + error.message);
            });
        });
        
        // Color selection
        colorOptions.forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.color-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                option.classList.add('selected');
                selectedColor = option.dataset.color;
            });
        });
        
        // Tab switching
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;
                
                // Update buttons
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');
                
                // Update contents
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId + 'Tab').classList.add('active');
                
                // If review tab is clicked, show password modal
                if (tabId === 'review') {
                    reviewPasswordModal.style.display = 'block';
                    secureModal.style.display = 'none';
                }
            });
        });
        
        // Submit Review Password
        submitReviewPassword.addEventListener('click', () => {
            if (reviewPassword.value === REVIEW_PASSWORD) {
                reviewPasswordModal.style.display = 'none';
                secureModal.style.display = 'block';
                reviewPasswordError.textContent = '';
                loadPendingApps();
            } else {
                reviewPasswordError.textContent = 'Incorrect review password';
            }
        });
        
        // Media type change
        mediaType.addEventListener('change', () => {
            imagePreview.style.display = 'none';
            videoPreview.style.display = 'none';
        });
        
        // Media URL input
        mediaUrl.addEventListener('input', () => {
            const url = mediaUrl.value;
            
            if (mediaType.value === 'image') {
                imagePreview.src = url;
                imagePreview.style.display = 'block';
                videoPreview.style.display = 'none';
            } else {
                videoPreview.src = url;
                videoPreview.style.display = 'block';
                imagePreview.style.display = 'none';
            }
        });
        
        // Save Media
        saveMediaBtn.addEventListener('click', () => {
            const userId = auth.currentUser.uid;
            const type = mediaType.value;
            const url = mediaUrl.value;
            const caption = mediaCaption.value;
            
            if (!url) {
                alert('Media URL is required');
                return;
            }
            
            const newMediaKey = database.ref().child('users/' + userId + '/secureMedia').push().key;
            
            database.ref('users/' + userId + '/secureMedia/' + newMediaKey).set({
                type: type,
                url: url,
                caption: caption || '',
                createdAt: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                alert('Media saved securely!');
                mediaUrl.value = '';
                mediaCaption.value = '';
                imagePreview.style.display = 'none';
                videoPreview.style.display = 'none';
            }).catch(error => {
                alert('Error saving media: ' + error.message);
            });
        });
        
        // Load pending apps for review
        function loadPendingApps() {
            database.ref('apps').orderByChild('status').equalTo('pending').once('value')
                .then((snapshot) => {
                    pendingApps.innerHTML = '';
                    
                    snapshot.forEach(childSnapshot => {
                        const app = childSnapshot.val();
                        const appId = childSnapshot.key;
                        
                        const appElement = document.createElement('div');
                        appElement.className = 'app-card';
                        appElement.style.border = '1px solid #ddd';
                        appElement.style.padding = '15px';
                        appElement.style.marginBottom = '15px';
                        appElement.style.borderRadius = '8px';
                        appElement.innerHTML = `
                            <h3>${app.name}</h3>
                            <p>${app.description || 'No description'}</p>
                            ${app.image ? `<img src="${app.image}" style="max-width: 100%; max-height: 150px;">` : ''}
                            <pre style="max-height: 150px; overflow: auto; background: #f5f5f5; padding: 10px;">${app.code}</pre>
                            <button class="approve-btn" data-id="${appId}" style="background-color: #2ecc71; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-right: 10px;">Approve</button>
                            <button class="reject-btn" data-id="${appId}" style="background-color: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px;">Reject</button>
                        `;
                        
                        pendingApps.appendChild(appElement);
                    });
                    
                    // Add event listeners to approve/reject buttons
                    document.querySelectorAll('.approve-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const appId = this.getAttribute('data-id');
                            database.ref('apps/' + appId).update({
                                status: 'approved',
                                reviewedAt: firebase.database.ServerValue.TIMESTAMP
                            }).then(() => {
                                alert('App approved!');
                                loadPendingApps();
                                loadApprovedApps();
                            }).catch(error => {
                                alert('Error approving app: ' + error.message);
                            });
                        });
                    });
                    
                    document.querySelectorAll('.reject-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const appId = this.getAttribute('data-id');
                            database.ref('apps/' + appId).update({
                                status: 'rejected',
                                reviewedAt: firebase.database.ServerValue.TIMESTAMP
                            }).then(() => {
                                alert('App rejected!');
                                loadPendingApps();
                            }).catch(error => {
                                alert('Error rejecting app: ' + error.message);
                            });
                        });
                    });
                })
                .catch(error => {
                    alert('Error loading pending apps: ' + error.message);
                });
        }
        
        // Load approved apps
        function loadApprovedApps() {
            database.ref('apps').orderByChild('status').equalTo('approved').once('value')
                .then((snapshot) => {
                    appsDisplay.innerHTML = '';
                    
                    snapshot.forEach(childSnapshot => {
                        const app = childSnapshot.val();
                        const appId = childSnapshot.key;
                        
                        const appElement = document.createElement('div');
                        appElement.className = 'app-item';
                        appElement.setAttribute('data-id', appId);
                        
                        // Calculate average rating
                        let totalRating = 0;
                        let ratingCount = 0;
                        if (app.ratings) {
                            Object.values(app.ratings).forEach(rating => {
                                totalRating += rating;
                                ratingCount++;
                            });
                        }
                        const avgRating = ratingCount > 0 ? (totalRating / ratingCount).toFixed(1) : 'Not rated';
                        
                        appElement.innerHTML = `
                            <h3>${app.name}</h3>
                            <p>${app.description || 'No description'}</p>
                            ${app.image ? `<img src="${app.image}">` : ''}
                            <div class="app-meta">
                                <div class="stars">${generateStarRating(avgRating)}</div>
                                <div>${app.playCount || 0} plays</div>
                            </div>
                        `;
                        
                        appsDisplay.appendChild(appElement);
                        
                        // Add click event to play app
                        appElement.addEventListener('click', () => {
                            playApp(appId, app);
                        });
                    });
                })
                .catch(error => {
                    alert('Error loading approved apps: ' + error.message);
                });
        }
        
        // Generate star rating display
        function generateStarRating(rating) {
            if (rating === 'Not rated') return rating;
            
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5 ? 1 : 0;
            const emptyStars = 5 - fullStars - halfStar;
            
            return '★'.repeat(fullStars) + '½'.repeat(halfStar) + '☆'.repeat(emptyStars) + ` (${rating})`;
        }
        
        // Play app
        function playApp(appId, app) {
            currentPlayingAppId = appId;
            playAppName.textContent = app.name;
            
            // Increment play count
            database.ref('apps/' + appId).transaction(app => {
                if (app) {
                    app.playCount = (app.playCount || 0) + 1;
                }
                return app;
            });
            
            // Display app in iframe
            const blob = new Blob([app.code], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            appPlayFrame.src = url;
            
            appPlayModal.style.display = 'block';
        }
        
        // Close App Play Modal
        closeAppPlayModal.addEventListener('click', () => {
            appPlayModal.style.display = 'none';
        });
        
        closeAppPlayBtn.addEventListener('click', () => {
            appPlayModal.style.display = 'none';
        });
        
        // Rate App
        rateAppBtn.addEventListener('click', () => {
            if (!currentPlayingAppId) return;
            
            const rating = prompt("Rate this app (1-5 stars):");
            if (rating && rating >= 1 && rating <= 5) {
                const userId = auth.currentUser.uid;
                database.ref('apps/' + currentPlayingAppId + '/ratings/' + userId).set(Number(rating))
                    .then(() => {
                        alert('Thank you for rating!');
                        loadApprovedApps();
                    })
                    .catch(error => {
                        alert('Error submitting rating: ' + error.message);
                    });
            } else {
                alert('Please enter a rating between 1 and 5');
            }
        });
        
        // Check auth state
        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    authContainer.style.display = 'none';
                    homeContainer.style.display = 'block';
                    
                    // Get user data from database
                    database.ref('users/' + user.uid).once('value')
                        .then((snapshot) => {
                            currentUserData = snapshot.val();
                            welcomeName.textContent = currentUserData.name;
                            profileName.textContent = currentUserData.name;
                            profilePic.src = currentUserData.photoUrl || 'https://via.placeholder.com/150';
                            
                            // Load approved apps
                            loadApprovedApps();
                            
                            // Apply profile color
                            if (currentUserData.profileColor) {
                                document.documentElement.style.setProperty('--primary-color', currentUserData.profileColor);
                            }
                        })
                        .catch(error => {
                            alert('Error loading user data: ' + error.message);
                        });
                } else {
                    // User is signed out
                    homeContainer.style.display = 'none';
                    authContainer.style.display = 'block';
                }
            });
        }
        
        // Initialize app
        checkAuthState();
    </script>
</body>
</html>
